<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>D√©clarations ‚Äì Laboratoire</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      --bg:#f5f5f8; --card:#fff; --accent:#2c7be5;
      --accent-soft:#e1ecff; --text:#222; --muted:#666; --border:#ddd;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui;background:var(--bg);color:var(--text)}
    .page{max-width:900px;margin:32px auto;padding:0 16px}
    header{margin-bottom:18px}
    h1{margin:0 0 6px;font-size:1.7rem;font-weight:650}
    .subtitle{margin:0;color:var(--muted);font-size:.95rem}

    .switcher{display:flex;gap:8px;margin:18px 0 14px}
    .switcher button{
      flex:1;border-radius:999px;border:1px solid var(--border);
      background:#fff;padding:10px 16px;font-size:.95rem;cursor:pointer;
      display:inline-flex;justify-content:center;align-items:center;gap:8px;
    }
    .switcher button.active{background:var(--accent-soft);border-color:var(--accent)}
    .hint{color:var(--muted);font-size:.9rem;margin:0 0 14px}

    form{background:var(--card);padding:18px;border-radius:10px;border:1px solid var(--border)}
    label{display:block;margin:0 0 10px;font-weight:600;font-size:.9rem}
    label span{display:block;color:var(--muted);font-weight:650;margin:0 0 6px;font-size:.85rem}
    input,select,textarea{
      width:100%;padding:10px 10px;border-radius:10px;border:1px solid var(--border);
      font:inherit;background:#fff
    }
    textarea{resize:vertical}
    button[type="submit"]{
      width:100%;margin-top:12px;background:var(--accent);color:#fff;border:0;
      padding:12px 14px;border-radius:10px;font-weight:700;cursor:pointer
    }
    button[type="submit"]:disabled{opacity:.6;cursor:not-allowed}
    footer{margin-top:12px;color:var(--muted);font-size:.85rem}

    .two-cols{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width: 740px){ .two-cols{grid-template-columns:1fr} }

    .authors-title{margin:10px 0 8px;font-weight:700;font-size:.9rem}
    .author-row{
      display:grid;grid-template-columns:1fr 1fr auto;gap:8px;align-items:center;margin-bottom:8px
    }
    @media (max-width: 740px){ .author-row{grid-template-columns:1fr 1fr} .author-row button{grid-column:1 / -1} }
    .btn-secondary{
      background:#fff;border:1px solid var(--border);border-radius:10px;padding:9px 10px;cursor:pointer;
      font-weight:650
    }
    .btn-danger{
      background:#fff;border:1px solid #e1b8b8;color:#b32020;border-radius:10px;padding:9px 10px;cursor:pointer;
      font-weight:700
    }
    .small-muted{color:var(--muted);font-size:.82rem}

    .opts{
      margin-top:14px;border-top:1px solid var(--border);padding-top:14px
    }
    .opts h3{margin:0 0 6px;font-size:1rem}
    .opts p{margin:0 0 10px;color:var(--muted);font-size:.9rem}
    .checks{display:flex;gap:12px;flex-wrap:wrap;margin-top:8px}
    .check{display:inline-flex;gap:8px;align-items:center;border:1px solid var(--border);padding:8px 10px;border-radius:999px;background:#fff}
    .check input{width:auto}

    .status{margin:10px 0 0;font-size:.9rem;color:var(--muted);white-space:pre-wrap}
    .status.ok{color:#1b7c3a}
    .status.err{color:#b32020}
  </style>
</head>

<body>
  <div class="page">
    <header>
      <h1>D√©clarations</h1>
      <p class="subtitle">D√©clarez une publication dans Zotero, et indiquez si vous souhaitez une action HAL / communication.</p>

      <div class="switcher">
        <button id="tab-publication" class="active" type="button">üìö Publication</button>
        <button id="tab-event" type="button">üìÖ √âv√©nement</button>
      </div>
    </header>

    <p class="hint">Choisissez le type (Livre / Chapitre / Article / Communication), puis remplissez les champs requis.</p>

    <form id="pub-form">
      <label>
        <span>Type de publication *</span>
        <select name="pubType" id="pubType">
          <option value="book">Livre</option>
          <option value="bookSection">Chapitre d‚Äôouvrage</option>
          <option value="journalArticle">Article (revue)</option>
          <option value="conferencePaper">Communication (conference paper)</option>
        </select>
      </label>

      <label>
        <span>Title *</span>
        <input name="title" required>
      </label>

      <div class="authors-title">Author(s) *</div>
      <div id="authors-list"></div>
      <div style="display:flex;align-items:center;gap:8px;margin:8px 0 12px">
        <button type="button" id="add-author-btn" class="btn-secondary">+ Ajouter un auteur</button>
        <span class="small-muted">Pr√©nom/Nom (minimum : un auteur)</span>
      </div>

      <!-- ====== CHAMPS LIVRE ====== -->
      <div id="book-fields">
        <div class="two-cols">
          <label><span>Date *</span><input name="date" placeholder="2024 ou 2024-06-15"></label>
          <label><span>Language</span><input name="language" placeholder="fr / en"></label>
        </div>

        <div class="two-cols">
          <label><span>Publisher *</span><input name="publisher"></label>
          <label><span>Place *</span><input name="place"></label>
        </div>

        <label><span>ISBN</span><input name="isbn" placeholder="978-..."></label>
        <label><span>Abstract</span><textarea name="abstract" rows="4"></textarea></label>
      </div>

      <!-- ====== CHAMPS CHAPITRE ====== -->
      <div id="section-fields" style="display:none">
        <label><span>Book Title *</span><input name="bookTitle"></label>

        <div class="two-cols">
          <label><span>Pages</span><input name="pages" placeholder="123-145"></label>
          <label><span>Edition</span><input name="edition"></label>
        </div>

        <div class="two-cols">
          <label><span>Series</span><input name="series"></label>
          <label><span>Series Number</span><input name="seriesNumber"></label>
        </div>

        <div class="two-cols">
          <label><span>Volume</span><input name="volume"></label>
          <label><span>Date *</span><input name="sectionDate" placeholder="2024 ou 2024-06-15"></label>
        </div>

        <div class="two-cols">
          <label><span>Publisher *</span><input name="sectionPublisher"></label>
          <label><span>Place *</span><input name="sectionPlace"></label>
        </div>

        <label><span>ISBN</span><input name="sectionIsbn" placeholder="978-..."></label>
      </div>

      <!-- ====== CHAMPS ARTICLE ====== -->
      <div id="article-fields" style="display:none">
        <div class="two-cols">
          <label><span>Publication (revue) *</span><input name="articlePublication" placeholder="Nom de la revue"></label>
          <label><span>Date *</span><input name="articleDate" placeholder="2024 ou 2024-06-15"></label>
        </div>

        <div class="two-cols">
          <label><span>Volume</span><input name="articleVolume"></label>
          <label><span>Issue</span><input name="articleIssue"></label>
        </div>

        <div class="two-cols">
          <label><span>Pages</span><input name="articlePages" placeholder="123-145"></label>
          <label><span>DOI</span>
            <div style="display:flex;gap:8px;align-items:center">
              <input name="articleDoi" id="articleDoi" placeholder="10.xxxx/xxxxx" style="flex:1">
              <button type="button" id="doi-prefill" class="btn-secondary" title="Pr√©remplir √† partir du DOI">‚ö° DOI</button>
            </div>
            <span class="small-muted">Collez un DOI (ou une URL doi.org), puis cliquez sur ‚ö°</span>
          </label>
        </div>

        <div class="two-cols">
          <label><span>Publisher</span><input name="articlePublisher"></label>
          <label><span>Place</span><input name="articlePlace"></label>
        </div>
      </div>

      <!-- ====== CHAMPS COMMUNICATION (CONFERENCE PAPER) ====== -->
      <div id="conference-fields" style="display:none">
        <div class="two-cols">
          <label><span>Conference Name *</span><input name="conferenceName" placeholder="Nom de la conf√©rence / colloque"></label>
          <label><span>Date *</span><input name="conferenceDate" placeholder="2015 ou 2015-06-15"></label>
        </div>

        <div class="two-cols">
          <label><span>Publisher</span><input name="conferencePublisher" placeholder="√âditeur (si actes publi√©s)"></label>
          <label><span>Place</span><input name="conferencePlace" placeholder="Lieu (ville/pays)"></label>
        </div>

        <label><span>Language</span><input name="conferenceLanguage" placeholder="fr / en"></label>

        <div class="opts" style="margin-top:14px">
          <h3>Extra (conf√©rence)</h3>
          <p>Ces informations seront ajout√©es dans Zotero (champ ‚ÄúExtra‚Äù).</p>

          <div class="two-cols">
            <label><span>tex.conferencestartdate</span><input name="tex_conferencestartdate" placeholder="2015-06-01"></label>
            <label><span>tex.conferenceenddate</span><input name="tex_conferenceenddate" placeholder="2015-06-03"></label>
          </div>

          <label><span>tex.conferenceorganizer</span><input name="tex_conferenceorganizer" placeholder="Organisateur¬∑rice / comit√©, etc."></label>

          <div class="two-cols">
            <label>
              <span>tex.x-audience</span>
              <input name="tex_x_audience" value="Not set" readonly>
            </label>

            <label>
              <span>tex.x-language</span>
              <input name="tex_x_language" placeholder="fr / en (si diff√©rent de Language)">
            </label>
          </div>

          <div class="two-cols">
            <label>
              <span>tex.x-invitedcommunication</span>
              <select name="tex_x_invitedcommunication">
                <option value="">‚Äî Choisir ‚Äî</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
              </select>
            </label>

            <label>
              <span>tex.x-peerreviewing</span>
              <select name="tex_x_peerreviewing">
                <option value="">‚Äî Choisir ‚Äî</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
              </select>
            </label>
          </div>

          <div class="two-cols">
            <label>
              <span>tex.x-popularlevel</span>
              <select name="tex_x_popularlevel">
                <option value="">‚Äî Choisir ‚Äî</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
              </select>
            </label>

            <label>
              <span>tex.x-proceedings</span>
              <select name="tex_x_proceedings">
                <option value="">‚Äî Choisir ‚Äî</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
              </select>
            </label>
          </div>
        </div>
      </div>

      <!-- ====== OPTIONS (HAL / COMMS / AXES) ====== -->
      <div class="opts">
        <h3>Options</h3>
        <p>Ces choix seront enregistr√©s dans Zotero (champ ‚ÄúExtra‚Äù).</p>

        <div class="two-cols">
          <label>
            <span>Souhaitez-vous la cr√©ation d‚Äôune notice sur HAL ? *</span>
            <select name="optHal" required>
              <option value="">‚Äî Choisir ‚Äî</option>
              <option value="yes">Oui</option>
              <option value="no">Non</option>
            </select>
          </label>

          <label>
            <span>Souhaitez-vous une communication (newsletter + r√©seaux sociaux) ? *</span>
            <select name="optComms" required>
              <option value="">‚Äî Choisir ‚Äî</option>
              <option value="yes">Oui</option>
              <option value="no">Non</option>
            </select>
          </label>
        </div>

        <!-- ‚úÖ Nouvelle option AXES -->
        <div style="margin-top:10px">
          <div style="font-weight:700;font-size:.9rem;margin:0 0 6px">
            Est-ce que votre publication/√©v√©nement est rattach√©e √† un axe th√©matique de recherche ?
          </div>
          <div class="checks">
            <label class="check"><input type="checkbox" name="axisPICMAP" value="PICMAP"> PICMAP</label>
            <label class="check"><input type="checkbox" name="axisMOPTIS" value="MOPTIS"> MOPTIS</label>
            <label class="check"><input type="checkbox" name="axisOCSO" value="OCSO"> OCSO</label>
          </div>
          <div class="small-muted" style="margin-top:6px">Vous pouvez cocher plusieurs axes.</div>
        </div>
      </div>

      <label>
        <span>Extra</span>
        <textarea name="extra" rows="4" placeholder="Infos internes, HAL, projet, axe, etc."></textarea>
      </label>

      <button type="submit">Envoyer vers Zotero</button>
      <p id="pub-status" class="status"></p>

      <footer>Les champs marqu√©s d‚Äôun * sont obligatoires.</footer>
    </form>
  </div>

  <script src="assets/app.js"></script>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <script>
    // Initialise le widget
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on("init", (user) => {
        // Si on arrive via un lien d'invitation / confirmation, Netlify met souvent un hash dans l‚ÄôURL
        // On ouvre le widget automatiquement pour permettre la cr√©ation/validation.
        if (!user) {
          const h = window.location.hash || "";
          if (h.includes("invite_token") || h.includes("confirmation_token") || h.includes("recovery_token")) {
            window.netlifyIdentity.open();
          }
        }
      });
    }
  </script>
</body>
</html>
