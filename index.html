<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Moulinette LAREQUOI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      --bg:#f5f5f8; --card:#fff; --accent:#2c7be5;
      --accent-soft:#e1ecff; --text:#222; --muted:#666; --border:#ddd;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui;background:var(--bg);color:var(--text)}
    .page{max-width:900px;margin:32px auto;padding:0 16px}
    header{margin-bottom:18px}
    h1{margin:0 0 6px;font-size:1.7rem;font-weight:650}
    .subtitle{margin:0;color:var(--muted);font-size:.95rem}

    .switcher{display:flex;gap:8px;margin:18px 0 14px}
    .switcher button{
      flex:1;border-radius:999px;border:1px solid var(--border);
      background:#fff;padding:10px 16px;font-size:.95rem;cursor:pointer;
      display:inline-flex;justify-content:center;align-items:center;gap:8px;
    }
    .switcher button.active{background:var(--accent-soft);border-color:var(--accent)}
    .hint{color:var(--muted);font-size:.9rem;margin:0 0 14px}

    form{background:var(--card);padding:18px;border-radius:10px;border:1px solid var(--border)}
    label{display:block;margin:0 0 10px;font-weight:600;font-size:.9rem}
    label span{display:block;margin:0 0 3px}
    input,select,textarea{
      width:100%;padding:8px;border-radius:6px;border:1px solid var(--border);
      font:inherit;background:#fff
    }
    textarea{resize:vertical}

    .two-cols{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px 16px}

    button[type="submit"]{
      margin-top:8px;padding:8px 16px;border-radius:999px;border:none;
      background:var(--accent);color:#fff;font-weight:700;cursor:pointer
    }
    button[disabled]{opacity:.7;cursor:default}

    .status{margin-top:8px;font-size:.9rem;white-space:pre-wrap}
    .status.ok{color:#1b7c3a}
    .status.err{color:#b32020}

    .authors-title{font-weight:700;margin:10px 0 6px}
    .author-row{border:1px solid var(--border);border-radius:8px;padding:10px;margin-bottom:8px}
    .btn-secondary{border-radius:999px;border:1px solid var(--border);background:#fff;padding:6px 12px;cursor:pointer}
    .small-muted{color:var(--muted);font-size:.85rem;margin-left:8px}

    .opts {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
      margin: 12px 0;
      background: #fff;
    }
    .opts h3 {
      margin: 0 0 8px;
      font-size: .95rem;
    }
    .opts p {
      margin: 0 0 10px;
      color: var(--muted);
      font-size: .85rem;
    }

    /* ‚úÖ AXES */
    .checks{
      display:flex;
      flex-wrap:wrap;
      gap:10px 14px;
      margin-top:6px;
    }
    .check{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border:1px solid var(--border);
      border-radius:999px;
      background:#fff;
      font-weight:600;
      font-size:.85rem;
      cursor:pointer;
      user-select:none;
    }
    .check input{
      width:16px;height:16px;
      margin:0;
    }

    footer{margin-top:18px;color:var(--muted);font-size:.8rem}
  </style>

  <link rel="stylesheet" href="/assets/ui.css">
</head>

<body class="page-index">
  <div class="page">
    <header class="hub">
      <div class="hub-brand">
        <div class="hub-brand-text">
          <h1 class="hub-title">Moulinette LAREQUOI</h1>
          <p class="subtitle">Les donn√©es sont envoy√©es automatiquement dans Zotero.</p>
        </div>

        <img
          class="hub-logo"
          src="/logo-larequoi-2020.jpg"
          alt="LAREQUOI ‚Äì UVSQ ‚Äì Universit√© Paris-Saclay"
          loading="lazy"
          decoding="async">
      </div>

      <div class="hub-cards">
        <a class="hub-card" href="/suivi.html" target="_blank" rel="noopener noreferrer">
          <h2>üìä Suivi public HAL &amp; communication</h2>
          <p>√âtat des demandes</p>
        </a>

        <a class="hub-card" href="/cv.html" target="_blank" rel="noopener noreferrer">
          <h2>üßæ G√©n√©rateur de CV</h2>
          <p>√Ä partir des publications d√©pos√©es dans la moulinette</p>
        </a>

        <a class="hub-card" href="/import.html">
          <h2>üì• Import par lot CSV HAL</h2>
          <p>‚Üí Moulinette</p>
        </a>

        <a class="hub-card" href="/conference.html">
          <h2>üé§ D√©clarer une communication</h2>
          <p>Conference Paper</p>
        </a>
      </div>
    </header>

    <div class="switcher">
      <button type="button" class="active">Nouvelle publication</button>
    </div>

    <p class="hint">Choisissez le type (Livre / Chapitre / Article), puis remplissez les champs requis.</p>

    <form id="pub-form">
      <label>
        <span>Type de publication *</span>
        <select name="pubType" id="pubType">
          <option value="book">Livre</option>
          <option value="bookSection">Chapitre d‚Äôouvrage</option>
          <option value="journalArticle">Article (revue)</option>
        </select>
      </label>

      <label>
        <span>Title *</span>
        <input name="title" required>
      </label>

      <div class="authors-title">Author(s) *</div>
      <div id="authors-list"></div>
      <div style="display:flex;align-items:center;gap:8px;margin:8px 0 12px">
        <button type="button" id="add-author-btn" class="btn-secondary">+ Ajouter un auteur</button>
        <span class="small-muted">Pr√©nom/Nom (minimum : un auteur)</span>
      </div>

      <!-- ====== CHAMPS LIVRE ====== -->
      <div id="book-fields">
        <div class="two-cols">
          <label><span>Date *</span><input name="date" placeholder="2024 ou 2024-06-15"></label>
          <label><span>Language</span><input name="language" placeholder="fr / en"></label>
        </div>

        <div class="two-cols">
          <label><span>Publisher *</span><input name="publisher"></label>
          <label><span>Place *</span><input name="place"></label>
        </div>

        <label><span>ISBN</span><input name="isbn" placeholder="978-..."></label>
        <label><span>Abstract</span><textarea name="abstract" rows="4"></textarea></label>
      </div>

      <!-- ====== CHAMPS CHAPITRE ====== -->
      <div id="section-fields" style="display:none">
        <label><span>Book Title *</span><input name="bookTitle"></label>

        <div class="two-cols">
          <label><span>Pages</span><input name="pages" placeholder="123-145"></label>
          <label><span>Edition</span><input name="edition"></label>
        </div>

        <div class="two-cols">
          <label><span>Series</span><input name="series"></label>
          <label><span>Series Number</span><input name="seriesNumber"></label>
        </div>

        <div class="two-cols">
          <label><span>Volume</span><input name="volume"></label>
          <label><span>Date *</span><input name="sectionDate" placeholder="2024 ou 2024-06-15"></label>
        </div>

        <div class="two-cols">
          <label><span>Publisher *</span><input name="sectionPublisher"></label>
          <label><span>Place *</span><input name="sectionPlace"></label>
        </div>

        <label><span>ISBN</span><input name="sectionIsbn" placeholder="978-..."></label>
      </div>

      <!-- ====== CHAMPS ARTICLE ====== -->
      <div id="article-fields" style="display:none">
        <div class="two-cols">
          <label><span>Publication (revue) *</span><input name="articlePublication" placeholder="Nom de la revue"></label>
          <label><span>Date *</span><input name="articleDate" placeholder="2024 ou 2024-06-15"></label>
        </div>

        <div class="two-cols">
          <label><span>Volume</span><input name="articleVolume"></label>
          <label><span>Issue</span><input name="articleIssue"></label>
        </div>

        <div class="two-cols">
          <label><span>Pages</span><input name="articlePages" placeholder="123-145"></label>
          <label><span>DOI</span>
            <div style="display:flex;gap:8px;align-items:center">
              <input name="articleDoi" id="articleDoi" placeholder="10.xxxx/xxxxx" style="flex:1">
              <button type="button" id="doi-prefill" class="btn-secondary" title="Pr√©remplir √† partir du DOI">‚ö° DOI</button>
            </div>
            <span class="small-muted">Collez un DOI (ou une URL doi.org), puis cliquez sur ‚ö°</span>
          </label>
        </div>

        <div class="two-cols">
          <label><span>Publisher</span><input name="articlePublisher"></label>
          <label><span>Place</span><input name="articlePlace"></label>
        </div>
      </div>

      <!-- ====== OPTIONS (HAL / COMMS / AXES) ====== -->
      <div class="opts">
        <h3>Options</h3>
        <p>Ces choix seront enregistr√©s dans Zotero (champ ‚ÄúExtra‚Äù).</p>

        <div class="two-cols">
          <label>
            <span>Souhaitez-vous la cr√©ation d‚Äôune notice sur HAL ? *</span>
            <select name="optHal" required>
              <option value="">‚Äî Choisir ‚Äî</option>
              <option value="yes">Oui</option>
              <option value="no">Non</option>
            </select>
          </label>

          <label>
            <span>Souhaitez-vous une communication (newsletter + r√©seaux sociaux) ? *</span>
            <select name="optComms" required>
              <option value="">‚Äî Choisir ‚Äî</option>
              <option value="yes">Oui</option>
              <option value="no">Non</option>
            </select>
          </label>
        </div>

        <!-- ‚úÖ Nouvelle option AXES -->
        <div style="margin-top:10px">
          <div style="font-weight:700;font-size:.9rem;margin:0 0 6px">
            Est-ce que votre publication/√©v√©nement est rattach√©e √† un axe th√©matique de recherche ?
          </div>
          <div class="checks">
            <label class="check"><input type="checkbox" name="axisPICMAP" value="PICMAP"> PICMAP</label>
            <label class="check"><input type="checkbox" name="axisMOPTIS" value="MOPTIS"> MOPTIS</label>
            <label class="check"><input type="checkbox" name="axisOCSO" value="OCSO"> OCSO</label>
          </div>
          <div class="small-muted" style="margin-top:6px">Vous pouvez cocher plusieurs axes.</div>
        </div>
      </div>

      <label>
        <span>Extra</span>
        <textarea name="extra" rows="4" placeholder="Infos internes, HAL, projet, axe, etc."></textarea>
      </label>

      <button type="submit">Envoyer vers Zotero</button>
      <p id="pub-status" class="status"></p>

      <footer>Les champs marqu√©s d‚Äôun * sont obligatoires.</footer>
    </form>

    <footer class="site-footer">
      <p>En cas de probl√®me, n‚Äôh√©site pas √† contacter <a href="mailto:maximilien.petit@uvsq.fr">maximilien.petit@uvsq.fr</a></p>
    </footer>
  </div>

  <script src="assets/app.js"></script>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
<script>
  // Initialise le widget
  if (window.netlifyIdentity) {
    window.netlifyIdentity.on("init", (user) => {
      // Si on arrive via un lien d'invitation / confirmation, Netlify met souvent un hash dans l‚ÄôURL
      // On ouvre le widget automatiquement pour permettre la cr√©ation/validation.
      if (!user) {
        const h = window.location.hash || "";
        if (h.includes("invite_token") || h.includes("confirmation_token") || h.includes("recovery_token")) {
          window.netlifyIdentity.open();
        }
      }
    });
    window.netlifyIdentity.init();
  }
</script>
<script>
  (function(){
    var h = window.location.hash || "";
    if (h.includes("invite_token=") || h.includes("confirmation_token=") || h.includes("recovery_token=") || h.includes("email_change_token=")) {
      window.location.replace("/auth.html" + h);
    }
  })();
</script>

</body>
</html>
